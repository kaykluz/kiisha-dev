/**
 * Extraction Evaluation Fixtures
 * 
 * Sample fixtures for testing document extraction accuracy.
 */

import { registerFixture, EvalFixture } from "../runner";

// ============================================================================
// Document Classification Fixtures
// ============================================================================

registerFixture({
  id: "doc-classify-ppa",
  task: "DOC_CLASSIFY",
  name: "Classify PPA Document",
  description: "Should correctly classify a Power Purchase Agreement",
  input: {
    messages: [
      {
        role: "user",
        content: `Classify this document:

POWER PURCHASE AGREEMENT

This Power Purchase Agreement ("Agreement") is entered into as of January 1, 2024,
by and between Solar Energy Corp ("Seller") and Utility Company Inc ("Buyer").

WHEREAS, Seller owns and operates a 50 MW solar photovoltaic facility located at
123 Solar Way, Phoenix, AZ 85001 (the "Facility");

WHEREAS, Buyer desires to purchase electrical energy generated by the Facility;

NOW, THEREFORE, the parties agree as follows:

1. TERM: This Agreement shall be effective for a period of twenty (20) years.
2. PRICE: Buyer shall pay Seller $45.00 per MWh for all energy delivered.
3. DELIVERY POINT: The Delivery Point shall be the high side of the step-up transformer.`,
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "document_classification",
        strict: true,
        schema: {
          type: "object",
          properties: {
            category: { type: "string" },
            subcategory: { type: "string" },
            confidence: { type: "number" },
          },
          required: ["category", "subcategory", "confidence"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      category: "Commercial",
      subcategory: "Power Purchase Agreement",
    },
  },
});

registerFixture({
  id: "doc-classify-permit",
  task: "DOC_CLASSIFY",
  name: "Classify Environmental Permit",
  description: "Should correctly classify an environmental permit document",
  input: {
    messages: [
      {
        role: "user",
        content: `Classify this document:

ENVIRONMENTAL PERMIT
Permit No: ENV-2024-00123

DEPARTMENT OF ENVIRONMENTAL QUALITY
STATE OF ARIZONA

This permit is issued to: Green Wind LLC
Project: Wind Farm Development Phase II
Location: Maricopa County, AZ

PERMITTED ACTIVITIES:
- Construction of 25 wind turbines
- Associated transmission infrastructure
- Access roads and staging areas

ENVIRONMENTAL CONDITIONS:
1. All construction activities shall comply with the Migratory Bird Treaty Act
2. Noise levels shall not exceed 45 dB(A) at nearest residence
3. Stormwater management plan must be implemented

EFFECTIVE DATE: March 1, 2024
EXPIRATION DATE: February 28, 2029`,
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "document_classification",
        strict: true,
        schema: {
          type: "object",
          properties: {
            category: { type: "string" },
            subcategory: { type: "string" },
            confidence: { type: "number" },
          },
          required: ["category", "subcategory", "confidence"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      category: "Regulatory",
      subcategory: "Environmental Permit",
    },
  },
});

// ============================================================================
// Field Extraction Fixtures
// ============================================================================

registerFixture({
  id: "extract-ppa-fields",
  task: "DOC_EXTRACT_FIELDS",
  name: "Extract PPA Key Fields",
  description: "Should extract key fields from a PPA with evidence references",
  input: {
    messages: [
      {
        role: "user",
        content: `Extract the following fields from this PPA:
- Contract parties (buyer and seller)
- Facility capacity (MW)
- Contract term (years)
- Energy price ($/MWh)
- Facility location

Document:
POWER PURCHASE AGREEMENT

This Power Purchase Agreement is entered into as of January 1, 2024,
by and between SunPower Holdings LLC ("Seller") and Pacific Gas & Electric ("Buyer").

The Seller owns and operates a 75 MW solar photovoltaic generating facility
located at 456 Desert Road, Riverside County, California 92201 (the "Facility").

ARTICLE 2 - TERM
The initial term of this Agreement shall be twenty-five (25) years from the
Commercial Operation Date.

ARTICLE 3 - PRICING
The Contract Price shall be $52.50 per MWh, subject to annual escalation of 2%.`,
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "ppa_extraction",
        strict: true,
        schema: {
          type: "object",
          properties: {
            seller: { type: "string" },
            buyer: { type: "string" },
            capacity_mw: { type: "number" },
            term_years: { type: "number" },
            price_per_mwh: { type: "number" },
            location: { type: "string" },
          },
          required: ["seller", "buyer", "capacity_mw", "term_years", "price_per_mwh", "location"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      seller: "SunPower Holdings LLC",
      buyer: "Pacific Gas & Electric",
      capacity_mw: 75,
      term_years: 25,
      price_per_mwh: 52.5,
      location: "456 Desert Road, Riverside County, California 92201",
    },
  },
});

registerFixture({
  id: "extract-turbine-specs",
  task: "DOC_EXTRACT_FIELDS",
  name: "Extract Wind Turbine Specifications",
  description: "Should extract technical specifications from turbine datasheet",
  input: {
    messages: [
      {
        role: "user",
        content: `Extract turbine specifications from this datasheet:

VESTAS V150-4.2 MW WIND TURBINE
Technical Specifications

ROTOR
- Diameter: 150 meters
- Swept area: 17,671 m²
- Number of blades: 3
- Rotational speed: 4.0-11.3 rpm

GENERATOR
- Rated power: 4,200 kW
- Cut-in wind speed: 3 m/s
- Rated wind speed: 12 m/s
- Cut-out wind speed: 25 m/s

TOWER
- Hub height options: 105m, 125m, 148m, 166m
- Tower type: Tubular steel

OPERATING CONDITIONS
- Temperature range: -20°C to +45°C
- Design lifetime: 25 years`,
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "turbine_specs",
        strict: true,
        schema: {
          type: "object",
          properties: {
            model: { type: "string" },
            rated_power_kw: { type: "number" },
            rotor_diameter_m: { type: "number" },
            cut_in_speed_ms: { type: "number" },
            rated_wind_speed_ms: { type: "number" },
            cut_out_speed_ms: { type: "number" },
            design_lifetime_years: { type: "number" },
          },
          required: ["model", "rated_power_kw", "rotor_diameter_m"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      model: "Vestas V150-4.2 MW",
      rated_power_kw: 4200,
      rotor_diameter_m: 150,
      cut_in_speed_ms: 3,
      rated_wind_speed_ms: 12,
      cut_out_speed_ms: 25,
      design_lifetime_years: 25,
    },
  },
});

// ============================================================================
// Intent Classification Fixtures
// ============================================================================

registerFixture({
  id: "intent-search-docs",
  task: "INTENT_CLASSIFY",
  name: "Classify Document Search Intent",
  description: "Should classify user intent to search for documents",
  input: {
    messages: [
      {
        role: "user",
        content: "Find all PPAs for the Sunrise Solar project",
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "intent_classification",
        strict: true,
        schema: {
          type: "object",
          properties: {
            intent: { type: "string" },
            entities: {
              type: "object",
              properties: {
                document_type: { type: "string" },
                project_name: { type: "string" },
              },
            },
            confidence: { type: "number" },
          },
          required: ["intent", "confidence"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      intent: "search_documents",
    },
  },
});

registerFixture({
  id: "intent-check-compliance",
  task: "INTENT_CLASSIFY",
  name: "Classify Compliance Check Intent",
  description: "Should classify user intent to check compliance status",
  input: {
    messages: [
      {
        role: "user",
        content: "What permits are expiring in the next 90 days?",
      },
    ],
    responseFormat: {
      type: "json_schema",
      json_schema: {
        name: "intent_classification",
        strict: true,
        schema: {
          type: "object",
          properties: {
            intent: { type: "string" },
            entities: {
              type: "object",
              properties: {
                time_range_days: { type: "number" },
                document_type: { type: "string" },
              },
            },
            confidence: { type: "number" },
          },
          required: ["intent", "confidence"],
        },
      },
    },
  },
  expectedOutput: {
    type: "json_match",
    value: {
      intent: "check_compliance",
    },
  },
});

console.log("[Eval Fixtures] Extraction fixtures registered");
